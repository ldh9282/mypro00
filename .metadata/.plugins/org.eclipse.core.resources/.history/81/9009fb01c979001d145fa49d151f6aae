<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>

<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>

<c:set var="contextPath" value="<%=request.getContextPath() %>" />

<%@ include file="../myinclude/myheader.jsp" %>

<div id="page-wrapper">
    <div class="row">
        <div class="col-lg-12">
            <h3 class="page-header">Board - Modify</h3>
        </div><%-- /.col-lg-12 --%>
    </div><%-- /.row --%>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading"><h4>게시물 수정-삭제</h4></div><%-- /.panel-heading --%>
                <div class="panel-body">

<form role="form" method="post" name="frmBoard" id="frmModify">
	<div class="form-group">
	    <label>글번호</label><input class="form-control" name="bno" value='<c:out value="${board.bno }"/>' 
	    						   readonly="readonly" />
	</div>
	<div class="form-group">
	    <label>글제목</label><input class="form-control" name="btitle" value='<c:out value="${board.btitle }"/>'
	                             /> 
	</div>


	<div class="form-group">
		<label>글내용</label>	<%-- <textarea>와 </textarea>는 사이에 공백이 없어야
								  데이터베이스 저장 시에 필요 없는 공백이 포함되지 않음 --%>
		<textarea class="form-control" rows="3" name="bcontent"
				  ><c:out value="${board.bcontent}"/></textarea>
	</div>

	<div class="form-group">
		<label>작성자</label>
		<input class="form-control" name="bwriter" value='<c:out value="${board.bwriter}"/>'
			   readonly="readonly"/>
	</div>
	
	<div class="form-group">
		<label>최종수정일</label> [등록일시: <fmt:formatDate pattern="yyyy/MM/dd HH:mm:ss"
											 			value="${board.bregDate}"/>]
		<input class="form-control" name="bmodDate"
			   value='<fmt:formatDate pattern="yyyy/MM/dd HH:mm:ss" value="${board.bmodDate}"/>'
			   disabled="disabled" />
	</div>
	<button type="button" class="btn btn-default" id="btnModify" data-oper="modify">수정</button>
	<button type="button" class="btn btn-danger" id="btnRemove" data-oper="remove">삭제</button>
	<button type="button" class="btn btn-info" id="btnList" data-oper="list">취소</button>
	
	<input type="hidden" name="pageNum" value="${myBoardPagingDTO.pageNum }"/>
	<input type="hidden" name="rowAmountPerPage" value="${myBoardPagingDTO.rowAmountPerPage }"/>
	<input type="hidden" name="scope" value="${myBoardPagingDTO.scope }"/>
	<input type="hidden" name="keyword" value="${myBoardPagingDTO.keyword }"/>
	
</form>
                    
                </div><%-- /.panel-body --%>
            </div><%-- /.panel --%>
        </div><%-- /.col-lg-12 --%>
    </div><%-- /.row --%>
    
    <%-- 첨부파일 표시 --%>
	<div class="row">
		<div class="col-lg-12">
			<div class="panel panel-default">
				<div class="panel-heading">파일첨부</div>
					<div class="panel-body" >
						<div class="form-group uploadDiv">
							<input id="inputFile" type="file" name="uploadFiles" multiple><br>
						</div>
						<div class="form-group fileUploadResult">
							<ul>
							<!-- 업로드 후 결과처리 로직이 표시될 영역 -->
							</ul>
						</div>
					</div><!-- /.panel-body -->
				</div><!-- /.panel -->
		</div><!-- /.col-lg-12 -->
	</div><!-- /.row -->
</div><%-- /#page-wrapper --%>

<script>

function showUploadedFiles(uploadResult) {
	
	if(!uploadResult || uploadResult.length == 0) {
		return ;	
	}
	
	var fileUploadResult = $(".fileUploadResult ul") ;
	
	var str = "";
	
	
	$(uploadResult).each(function(i, obj){
	
		
		//calledPathFileName = encodeURI(calledPathFileName.replace(new RegExp(/\\/g), "/")) ;
	
		if (obj.fileType == "F") {
		
			var calledPathFileName =  obj.repoPath + "/" + obj.uploadPath + "/" + obj.uuid + "_" + obj.fileName ;
			console.log("calledPathFileName: "+ calledPathFileName);
			
			str += "<li data-repopath='" + obj.repoPath + "'" 
			    +  "    data-uploadpath='" + obj.uploadPath + "'" 
			    +  "    data-uuid='" + obj.uuid + "'"
			    +  "    data-filename='" + obj.fileName + "' data-filetype='F'>" 
			    +  "    <img src='${contextPath}/resources/img/icon-attach.png'"
			    +  "         alt='No icon' style='height:18px; width: 18px;' />&nbsp;"
			    +       obj.fileName
			    + " 	&nbsp;<button type='button' class='btn btn-danger btn-xs' "
			    + " 	data-filename='" + calledPathFileName + "' data-filetype='F'>X</button>"
			    +  "</li>" ;
			
		} else  {  //if(obj.fileType == "I")

			var thumbnailPath =  obj.repoPath + "/" + obj.uploadPath + "/s_" + obj.uuid + "_" + obj.fileName ;
		
			
			str += "<li data-repopath='" + obj.repoPath + "'" 
		    	+  "    data-uploadpath='" + obj.uploadPath + "'" 
			    +  "    data-uuid='" + obj.uuid + "'"
			    +  "    data-filename='" + obj.fileName + "' data-filetype='I'>"
			    +  "    <img src='${contextPath}/displayThumbnail?fileName=" + encodeURI(thumbnailPath) + "'"
			    +  "         alt='No Image' style='height:18px; width: 18px;'/>&nbsp;" 
			    +       obj.fileName
			    + " 	&nbsp;<button type='button' class='btn btn-danger btn-xs'"
			    + " 	data-filename='" + thumbnailFilePath + "' data-filetype='I'>X</button>"
			    +  "</li>" ;
		}
		
	});

	fileUploadResult.append(str) ;
}


$(document).ready(function() {
	
});


//기존 내용 삭제 후, 아래의 내용 추가 작성(오타, 대소문자 주의!!!)
//form의 수정/삭제/목록보기 버튼 클릭 에벤트 처리
var frmModify = $("#frmModify");

$('button').on("click", function(e){
	//e.preventDefault(); //버튼 유형이 submit가 아니므로 설정할 필요 없음
	var operation = $(this).data("oper"); //각 버튼의 data-xxx 속성에 설정된 값을 저장
	//alert("operation: "+ operation);
	
	if(operation == "modify"){ //게시물 수정 요청
		frmModify.attr("action", "${contextPath}/myboard/modify");

	} else if(operation == "remove"){ //게시물 삭제 요청
		frmModify.attr("action", "${contextPath}/myboard/delete");
		//frmModify.attr("action", "${contextPath}/myboard/remove");

	} else if(operation == "list"){ //게시물 목록 화면 요청
		var pageNumInput = $("input[name='pageNum']").clone() ;
	    var rowAmountPerPageInput = $("input[name='rowAmountPerPage']").clone() ;
	    var scopeInput = $("input[name='scope']").clone() ;
	    var keywordInput = $("input[name='keyword']").clone() ;
	    
	    
	    frmModify.empty();
	    
		frmModify.attr("action","${contextPath}/myboard/list").attr("method","get");
		
		frmModify.append(pageNumInput);
		frmModify.append(rowAmountPerPageInput) ;
		frmModify.append(scopeInput) ;
		frmModify.append(keywordInput) ;
		
	}
	
	frmModify.submit() ; //요청 전송
});
</script>

<%@ include file="../myinclude/myfooter.jsp" %>
        
        
